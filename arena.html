<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>血色秘境 • 灵剑</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/arena.css">
</head>
<body>

<canvas id="gameCanvas"></canvas>

<div id="ui-layer">
    <!-- 顶部HUD -->
    <div class="hud-top">
        <div class="avatar-frame" id="avatar-container"></div>
        <div class="bars">
            <div class="rank-info">
                <span id="rank-name">练气期</span> <span id="rank-lvl">1层</span>
            </div>
            <div class="bar-wrap"><div id="hp-bar" class="bar-fill hp"></div><div class="bar-text">气血</div></div>
            <div class="bar-wrap"><div id="exp-bar" class="bar-fill exp"></div><div class="bar-text">修为</div></div>
        </div>
        <div class="arena-info">
            <div class="wave-display">
                <span class="wave-label">第</span>
                <span class="wave-number" id="wave-num">1</span>
                <span class="wave-label">/10 波</span>
            </div>
            <div class="enemy-count">
                剩余: <span id="enemy-count">0</span> 只
            </div>
        </div>
        <div class="gold-counter">
            <span class="gold-icon">💰</span>
            <span class="gold-value" id="gold-count">0</span>
        </div>
    </div>

    <!-- 道具卡槽 -->
    <div class="item-slots" id="item-slots">
        <div class="item-slot" data-slot="0" onclick="useItemCard(0)">
            <div class="slot-content"></div>
            <div class="slot-key">1</div>
        </div>
        <div class="item-slot" data-slot="1" onclick="useItemCard(1)">
            <div class="slot-content"></div>
            <div class="slot-key">2</div>
        </div>
        <div class="item-slot" data-slot="2" onclick="useItemCard(2)">
            <div class="slot-content"></div>
            <div class="slot-key">3</div>
        </div>
        <div class="item-slot" data-slot="3" onclick="useItemCard(3)">
            <div class="slot-content"></div>
            <div class="slot-key">4</div>
        </div>
        <div class="item-slot" data-slot="4" onclick="useItemCard(4)">
            <div class="slot-content"></div>
            <div class="slot-key">5</div>
        </div>
        <div class="item-slot" data-slot="5" onclick="useItemCard(5)">
            <div class="slot-content"></div>
            <div class="slot-key">6</div>
        </div>
    </div>

    <!-- BOSS血条 (默认隐藏) -->
    <div class="boss-hud hidden" id="boss-hud">
        <div class="boss-name" id="boss-name">赤玉蛛王</div>
        <div class="boss-hp-wrap">
            <div class="boss-hp-bar" id="boss-hp-bar"></div>
        </div>
    </div>
</div>

<!-- 遮罩层 -->
<div id="overlay">
    <!-- 开始菜单 -->
    <div id="start-menu" class="menu-box">
        <div class="arena-title">血色秘境</div>
        <p class="arena-subtitle">妖兽横行的血色禁地</p>
        
        <div class="arena-desc">
            <p>📜 十波妖潮，层层递进</p>
            <p>🕷️ 第五波：小BOSS <span class="boss-text">赤玉蛛王</span></p>
            <p>🦂 第十波：大BOSS <span class="boss-text">炎煞蝎皇</span></p>
            <p>💀 死亡即失败，谨慎应战</p>
        </div>

        <div class="current-role" id="current-role-display" style="margin: 20px 0; padding: 15px; background: rgba(139,0,0,0.2); border: 1px solid #5a2020; border-radius: 10px;">
            <div style="color: #888; font-size: 14px; margin-bottom: 8px;">当前角色</div>
            <div style="display: flex; align-items: center; justify-content: center; gap: 15px;">
                <div class="role-icon" id="current-role-icon" style="width: 50px; height: 50px; background: rgba(255,255,255,0.05); border-radius: 50%; display: flex; align-items: center; justify-content: center; border: 2px solid #c0392b;"></div>
                <div>
                    <div id="current-role-name" style="font-size: 24px; color: #c0392b;">天剑宗</div>
                </div>
            </div>
        </div>

        <div class="btn-group">
            <button class="btn arena-btn" onclick="enterArena()">
                ⚔️ 进入秘境 ⚔️
            </button>
            <button class="btn back-btn" onclick="backToMain()">
                返回山门
            </button>
        </div>
    </div>

    <!-- BOSS倒计时 -->
    <div id="boss-countdown" class="menu-box hidden">
        <div class="countdown-number" id="countdown-num">3</div>
        <div class="countdown-text" id="countdown-text">BOSS 来袭</div>
    </div>

    <!-- 升级菜单 -->
    <div id="levelup-menu" class="menu-box hidden">
        <h2 class="levelup-title">顿悟机缘</h2>
        <div class="card-container" id="card-container"></div>
    </div>

    <!-- 胜利结算 -->
    <div id="victory-menu" class="menu-box hidden">
        <div class="result-title victory">✨ 血色秘境 · 通关 ✨</div>
        <div class="result-box">
            <div class="result-row">
                <span class="result-label">击杀妖兽:</span>
                <span class="result-value" id="result-kills">0</span>
                <span class="result-unit">只</span>
            </div>
            <div class="result-row">
                <span class="result-label">获得金币:</span>
                <span class="result-value gold" id="result-gold">0</span>
                <span class="result-unit">💰</span>
            </div>
            <div class="result-row">
                <span class="result-label">通关用时:</span>
                <span class="result-value" id="result-time">00:00</span>
            </div>
            <div class="result-row">
                <span class="result-label">评价:</span>
                <span class="result-value stars" id="result-stars">⭐⭐⭐</span>
            </div>
        </div>
        <div class="btn-group">
            <button class="btn arena-btn" onclick="restartArena()">再次挑战</button>
            <button class="btn back-btn" onclick="backToMain()">返回山门</button>
        </div>
    </div>

    <!-- 失败结算 -->
    <div id="defeat-menu" class="menu-box hidden">
        <div class="result-title defeat">💀 试炼失败 💀</div>
        <div class="result-box">
            <div class="result-row">
                <span class="result-label">坚持到:</span>
                <span class="result-value">第 <span id="defeat-wave">1</span> 波</span>
            </div>
            <div class="result-row">
                <span class="result-label">击杀妖兽:</span>
                <span class="result-value" id="defeat-kills">0</span>
                <span class="result-unit">只</span>
            </div>
            <div class="result-row">
                <span class="result-label">获得金币:</span>
                <span class="result-value gold" id="defeat-gold">0</span>
                <span class="result-unit">💰 (保留50%)</span>
            </div>
            <div class="defeat-quote">"修为尚浅，来日再战"</div>
        </div>
        <div class="btn-group">
            <button class="btn arena-btn" onclick="restartArena()">再次挑战</button>
            <button class="btn back-btn" onclick="backToMain()">返回山门</button>
        </div>
    </div>
</div>

<!-- 金币飞行容器 -->
<div id="flying-coins"></div>

<!-- 技能选择 - 放在 overlay 外面，独立显示 -->
<div id="skill-overlay" class="skill-overlay hidden">
    <div class="skill-panel">
        <div class="skill-title">⚔️ 波次通过 · 选择功法 ⚔️</div>
        <div class="skill-choices" id="skill-choices"></div>
    </div>
</div>

<!-- 性能监控面板（调试用，按 F3 显示/隐藏）-->
<div id="perf-panel" style="display:none; position:fixed; top:10px; right:10px; background:rgba(0,0,0,0.8); color:#fff; padding:15px; border-radius:8px; font-family:monospace; font-size:12px; z-index:9999;">
    <div style="color:#f1c40f; margin-bottom:8px;">📊 性能监控</div>
    <div>FPS: <span id="perf-fps" style="color:#4caf50;">60</span></div>
    <div>敌人: <span id="perf-enemies">0</span></div>
    <div>子弹: <span id="perf-bullets">0</span></div>
    <div>粒子: <span id="perf-particles">0</span></div>
    <div>碰撞检测: <span id="perf-collision" style="color:#2196f3;">优化中</span></div>
</div>

<script>
// 性能面板快捷键
document.addEventListener('keydown', e => {
    if (e.key === 'F3') {
        const panel = document.getElementById('perf-panel');
        panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        e.preventDefault();
    }
});
</script>

<script type="module" src="js/arena-main.js"></script>
</body>
</html>

