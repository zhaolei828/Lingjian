@import url('https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&display=swap');

body {
    margin: 0; overflow: hidden; background-color: #050505;
    font-family: 'Ma Shan Zheng', 'KaiTi', serif;
    user-select: none; color: #fff;
}
canvas { display: block; }

#ui-layer {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    pointer-events: none; display: flex; flex-direction: column;
}

/* 顶部HUD */
.hud-top { padding: 20px; display: flex; align-items: flex-start; gap: 20px; z-index: 5; }
.avatar-frame {
    width: 80px; height: 80px; border-radius: 50%;
    border: 3px solid #f1c40f; box-shadow: 0 0 15px #f1c40f;
    background: #222; overflow: hidden; position: relative;
}
.avatar-frame img { width: 100%; height: 100%; object-fit: cover; }

.bars { flex: 1; max-width: 400px; display: flex; flex-direction: column; gap: 8px; }
.bar-wrap { height: 16px; background: rgba(0,0,0,0.6); border: 1px solid #444; border-radius: 8px; overflow: hidden; position: relative; }
.bar-fill { height: 100%; transition: width 0.2s ease-out; }
#hp-bar { background: linear-gradient(90deg, #c0392b, #e74c3c); width: 100%; }
#exp-bar { background: linear-gradient(90deg, #8e44ad, #9b59b6); width: 0%; }
.bar-text { position: absolute; top: 0; left: 10px; font-size: 12px; line-height: 16px; text-shadow: 1px 1px 2px black; }

.score-board { position: absolute; top: 20px; right: 30px; text-align: right; }
.big-text { font-size: 32px; color: #f1c40f; text-shadow: 0 0 10px rgba(241, 196, 15, 0.5); }

/* 菜单遮罩 */
#overlay {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0, 0, 0, 0.85); backdrop-filter: blur(5px);
    display: flex; justify-content: center; align-items: center;
    z-index: 99; pointer-events: auto; transition: opacity 0.3s;
}
.hidden { opacity: 0 !important; pointer-events: none !important; }

.menu-box { text-align: center; animation: float 3s ease-in-out infinite; }
.game-title {
    font-size: 80px;
    background: linear-gradient(to bottom, #fff, #bdc3c7);
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
    text-shadow: 0 0 30px rgba(255,255,255,0.3); margin-bottom: 20px;
}

/* 卡片系统 */
.card-container { display: flex; gap: 30px; perspective: 1000px; }
.card {
    width: 220px; height: 320px;
    background: linear-gradient(160deg, #2c3e50, #000);
    border: 2px solid #d4af37; border-radius: 12px;
    padding: 20px; display: flex; flex-direction: column; align-items: center; justify-content: center;
    cursor: pointer; text-align: center; position: relative; overflow: hidden;
    box-shadow: 0 0 20px rgba(212, 175, 55, 0.2); transition: transform 0.3s;
}
.card:hover { transform: translateY(-20px) scale(1.05); box-shadow: 0 0 50px rgba(212, 175, 55, 0.6); border-color: #fff; }
.card-icon { font-size: 60px; margin-bottom: 20px; filter: drop-shadow(0 0 10px rgba(255,255,255,0.5)); }
.card h3 { color: #f1c40f; margin: 0 0 10px 0; font-size: 24px; }
.card p { color: #bdc3c7; font-size: 14px; line-height: 1.6; }
/* 稀有度边框颜色 */
.rare-fire { border-color: #e74c3c; box-shadow: 0 0 20px #c0392b; }
.rare-thunder { border-color: #f1c40f; box-shadow: 0 0 20px #f39c12; }
.rare-wood { border-color: #2ecc71; box-shadow: 0 0 20px #27ae60; }
.rare-water { border-color: #3498db; box-shadow: 0 0 20px #2980b9; }
.rare-earth { border-color: #e67e22; box-shadow: 0 0 20px #d35400; }

.btn {
    padding: 15px 50px; font-size: 24px; color: white;
    background: linear-gradient(45deg, #c0392b, #8e44ad);
    border: none; border-radius: 50px; cursor: pointer;
    box-shadow: 0 5px 15px rgba(192, 57, 43, 0.4); font-family: inherit;
}
.btn.secondary {
    background: linear-gradient(45deg, #34495e, #2c3e50);
    box-shadow: 0 5px 15px rgba(44, 62, 80, 0.4);
    border: 1px solid #7f8c8d;
    color: #bdc3c7;
}
.btn:hover { transform: scale(1.1); filter: brightness(1.2); }

.stage-select {
    background: rgba(0,0,0,0.3);
    padding: 15px;
    border-radius: 10px;
    text-align: center;
    margin: 10px 0;
    border: 1px solid #333;
}

.btn-mini {
    padding: 8px 15px;
    font-size: 16px;
    color: #bbb;
    background: rgba(0,0,0,0.6);
    border: 1px solid #555;
    border-radius: 6px;
    cursor: pointer;
    font-family: inherit;
    transition: all 0.2s;
    min-width: 60px;
}

.btn-mini:hover {
    background: #555;
    color: white;
    border-color: #888;
    transform: translateY(-2px);
    box-shadow: 0 2px 5px rgba(0,0,0,0.5);
}

/* Role Selection */
.role-select {
    display: flex; gap: 10px; margin-bottom: 15px; justify-content: center; 
    flex-wrap: nowrap !important; /* Force single line */
    flex-direction: row; /* Ensure row direction */
    align-items: flex-start;
}
.role-card {
    width: 110px; height: 190px; /* Fixed dimensions */
    min-width: 110px; /* Prevent shrinking */
    background: rgba(0,0,0,0.6);
    border: 2px solid #555; border-radius: 8px;
    border: 2px solid #555; border-radius: 8px;
    cursor: pointer; transition: all 0.3s;
    display: flex; flex-direction: column; align-items: center; justify-content: flex-start;
    padding: 10px 5px;
    position: relative;
    overflow: hidden;
}
.role-card:hover { border-color: #aaa; transform: translateY(-5px); background: rgba(50,50,50,0.8); }
.role-card.selected { border-color: #f1c40f; box-shadow: 0 0 15px #f1c40f; background: rgba(241, 196, 15, 0.1); }
.role-card h4 { color: #fff; margin: 8px 0 4px; font-size: 14px; text-shadow: 0 2px 2px #000; white-space: nowrap; }
.role-card p { color: #ccc; margin: 0 0 8px 0; font-size: 10px; padding: 0 2px; line-height: 1.2; height: 24px; overflow: hidden; text-overflow: ellipsis; }
.role-icon { width: 45px; height: 45px; background: rgba(255,255,255,0.05); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-bottom: 2px; border: 1px solid #444; }
.role-icon svg { width: 75%; height: 75%; filter: drop-shadow(0 0 5px rgba(0,0,0,0.5)); }

.stat-box { width: 100%; display: flex; flex-direction: column; gap: 3px; margin-top: auto; padding: 0 5px; box-sizing: border-box; }
.stat-row { display: flex; align-items: center; font-size: 9px; color: #888; gap: 3px; }
.stat-label { width: 12px; text-align: right; }
.stat-bar-bg { flex: 1; height: 3px; background: #333; border-radius: 2px; overflow: hidden; }
.stat-bar-fill { height: 100%; border-radius: 2px; }


@keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }

@media (max-height: 800px) {
    .game-title { font-size: 50px; margin-bottom: 10px; }
    .role-select { gap: 5px; margin-bottom: 10px; }
    .role-card { width: 90px; height: 160px; padding: 8px 4px; }
    .role-card h4 { font-size: 12px; margin: 5px 0 2px; }
    .role-card p { font-size: 9px; height: 20px; margin-bottom: 5px; }
    .role-icon { width: 35px; height: 35px; }
    .stat-box { gap: 2px; }
    .stat-row { font-size: 8px; }
    .stat-bar-bg { height: 2px; }
    .btn { padding: 10px 30px; font-size: 18px; }
    .stage-select { padding: 8px; margin: 5px 0; }
    .btn-mini { padding: 5px 10px; font-size: 12px; min-width: 50px; }
}

@media (max-height: 600px) {
    .game-title { font-size: 40px; margin-bottom: 5px; }
    .role-card { width: 80px; height: 140px; }
    .role-icon { width: 30px; height: 30px; }
    .stat-label { display: none; } /* Hide labels on very small screens */
    .btn { padding: 8px 20px; font-size: 16px; }
}

/* ========== 通用技能选择界面 ========== */
.skill-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.9);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 2000;
    animation: skillFadeIn 0.3s ease;
}

.skill-overlay.hidden {
    display: none !important;
}

.skill-panel {
    text-align: center;
    max-width: 90%;
}

.skill-title {
    font-size: 32px;
    color: #f1c40f;
    text-shadow: 0 0 20px rgba(241, 196, 15, 0.5);
    margin-bottom: 25px;
    animation: skillTitlePulse 2s ease-in-out infinite;
}

.skill-choices {
    display: flex;
    gap: 20px;
    justify-content: center;
    flex-wrap: wrap;
}

.skill-card {
    width: 150px;
    background: linear-gradient(135deg, #1a1a2e 0%, #0a0a15 100%);
    border: 2px solid #4a4a6a;
    border-radius: 12px;
    padding: 20px 15px;
    cursor: pointer;
    transition: all 0.3s ease;
    pointer-events: auto;
    animation: skillCardAppear 0.5s ease backwards;
}

.skill-card:nth-child(1) { animation-delay: 0.1s; }
.skill-card:nth-child(2) { animation-delay: 0.2s; }
.skill-card:nth-child(3) { animation-delay: 0.3s; }

.skill-card:hover {
    transform: translateY(-10px) scale(1.05);
    border-color: #f1c40f;
    box-shadow: 0 10px 30px rgba(241, 196, 15, 0.3);
}

.skill-card:active {
    transform: scale(0.95);
}

.skill-icon {
    font-size: 42px;
    margin-bottom: 10px;
}

.skill-info {
    text-align: center;
}

.skill-name {
    font-size: 18px;
    color: #f1c40f;
    margin-bottom: 8px;
    font-weight: bold;
}

.skill-desc {
    font-size: 13px;
    color: #aaa;
    line-height: 1.4;
}

@keyframes skillFadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes skillTitlePulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.02); }
}

@keyframes skillCardAppear {
    from { 
        opacity: 0; 
        transform: translateY(30px) scale(0.8); 
    }
    to { 
        opacity: 1; 
        transform: translateY(0) scale(1); 
    }
}

/* 移动端技能选择适配 - 保持横排显示 */
@media (max-width: 600px) {
    .skill-title { font-size: 20px !important; margin-bottom: 12px !important; }
    .skill-choices { 
        display: flex !important;
        flex-direction: row !important; /* 强制横排 */
        gap: 8px !important; 
        padding: 0 5px !important;
        justify-content: center !important;
        flex-wrap: nowrap !important; /* 不换行 */
    }
    .skill-card { 
        width: 95px !important; /* 更小的宽度适应3张卡 */
        min-width: 95px !important;
        padding: 10px 6px !important;
    }
    .skill-icon { font-size: 28px !important; margin-bottom: 5px !important; }
    .skill-info { text-align: center !important; }
    .skill-name { font-size: 12px !important; }
    .skill-desc { font-size: 10px !important; line-height: 1.2 !important; }
}

/* ========== Boss 倒计时动画 ========== */
.boss-countdown-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 1500;
    pointer-events: none;
}

.boss-countdown-overlay.hidden {
    display: none !important;
}

.boss-countdown-number {
    font-size: 150px;
    font-weight: bold;
    color: #c0392b;
    text-shadow: 
        0 0 30px #ff0000,
        0 0 60px #ff0000,
        0 0 90px #8b0000;
    /* 移除默认动画，由 JS 控制 */
}

.boss-countdown-number.final {
    font-size: 80px;
    color: #f1c40f;
    text-shadow: 
        0 0 30px #f1c40f,
        0 0 60px #ff8c00,
        0 0 90px #ff6600;
    animation: bossAppear 1s ease-out;
}

/* 小Boss动画 - 较小的震动 */
.boss-countdown-number.mini-boss {
    animation: countdownPulseMini 0.5s ease-out;
}

.boss-countdown-number.mini-boss.final {
    font-size: 60px;
    animation: bossAppearMini 0.8s ease-out;
}

/* 大Boss动画 - 夸张的震动和特效 */
.boss-countdown-number.final-boss {
    font-size: 180px;
    animation: countdownPulseFinal 0.5s ease-out;
    color: #ff0000;
    text-shadow: 
        0 0 50px #ff0000,
        0 0 100px #ff0000,
        0 0 150px #8b0000,
        0 0 200px #5c0000;
}

.boss-countdown-number.final-boss.final {
    font-size: 100px;
    animation: bossAppearFinal 1.5s ease-out;
}

.boss-name-text {
    font-size: 36px;
    color: #fff;
    margin-top: 20px;
    text-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
    animation: bossNameSlide 0.5s ease-out;
}

.boss-name-text.final-boss {
    font-size: 48px;
    color: #f1c40f;
    text-shadow: 
        0 0 20px #f1c40f,
        0 0 40px #ff8c00;
    animation: bossNameSlideFinal 0.8s ease-out;
}

/* 倒计时动画 - 确保数字始终可见 */
@keyframes countdownPulse {
    0% { transform: scale(0.3); opacity: 1; }
    20% { transform: scale(1.3); opacity: 1; }
    40% { transform: scale(0.9); opacity: 1; }
    60% { transform: scale(1.1); opacity: 1; }
    80% { transform: scale(0.95); opacity: 1; }
    100% { transform: scale(1); opacity: 1; }
}

@keyframes countdownPulseMini {
    0% { transform: scale(0.4); opacity: 1; }
    30% { transform: scale(1.2); opacity: 1; }
    60% { transform: scale(0.95); opacity: 1; }
    100% { transform: scale(1); opacity: 1; }
}

@keyframes countdownPulseFinal {
    0% { transform: scale(0.2) rotate(-15deg); opacity: 1; }
    25% { transform: scale(1.6) rotate(8deg); opacity: 1; }
    50% { transform: scale(0.85) rotate(-5deg); opacity: 1; }
    75% { transform: scale(1.1) rotate(2deg); opacity: 1; }
    100% { transform: scale(1) rotate(0deg); opacity: 1; }
}

/* Boss 出现动画 */
@keyframes bossAppear {
    0% { transform: scale(0); opacity: 0; }
    50% { transform: scale(1.3); }
    70% { transform: scale(0.9); }
    100% { transform: scale(1); opacity: 1; }
}

@keyframes bossAppearMini {
    0% { transform: scale(0); opacity: 0; }
    60% { transform: scale(1.2); }
    100% { transform: scale(1); opacity: 1; }
}

@keyframes bossAppearFinal {
    0% { transform: scale(0) rotate(-20deg); opacity: 0; }
    30% { transform: scale(1.8) rotate(10deg); }
    50% { transform: scale(0.8) rotate(-5deg); }
    70% { transform: scale(1.3) rotate(3deg); }
    100% { transform: scale(1) rotate(0deg); opacity: 1; }
}

@keyframes bossNameSlide {
    0% { transform: translateY(30px); opacity: 0; }
    100% { transform: translateY(0); opacity: 1; }
}

@keyframes bossNameSlideFinal {
    0% { transform: translateY(50px) scale(0.5); opacity: 0; }
    50% { transform: translateY(-10px) scale(1.1); }
    100% { transform: translateY(0) scale(1); opacity: 1; }
}

/* 屏幕震动效果 */
@keyframes screenShake {
    0%, 100% { transform: translateX(0); }
    10% { transform: translateX(-5px) translateY(2px); }
    20% { transform: translateX(5px) translateY(-2px); }
    30% { transform: translateX(-5px) translateY(2px); }
    40% { transform: translateX(5px) translateY(-2px); }
    50% { transform: translateX(-3px) translateY(1px); }
    60% { transform: translateX(3px) translateY(-1px); }
    70% { transform: translateX(-2px); }
    80% { transform: translateX(2px); }
    90% { transform: translateX(-1px); }
}

@keyframes screenShakeFinal {
    0%, 100% { transform: translateX(0); }
    5% { transform: translateX(-10px) translateY(5px) rotate(-1deg); }
    10% { transform: translateX(10px) translateY(-5px) rotate(1deg); }
    15% { transform: translateX(-10px) translateY(5px) rotate(-1deg); }
    20% { transform: translateX(10px) translateY(-5px) rotate(1deg); }
    25% { transform: translateX(-8px) translateY(4px); }
    30% { transform: translateX(8px) translateY(-4px); }
    35% { transform: translateX(-6px) translateY(3px); }
    40% { transform: translateX(6px) translateY(-3px); }
    50% { transform: translateX(-4px) translateY(2px); }
    60% { transform: translateX(4px) translateY(-2px); }
    70% { transform: translateX(-2px) translateY(1px); }
    80% { transform: translateX(2px) translateY(-1px); }
}

.shake-screen {
    animation: screenShake 0.5s ease-in-out;
}

.shake-screen-final {
    animation: screenShakeFinal 1s ease-in-out;
}

/* ========== 通用道具栏样式 ========== */
.item-slots {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 8px;
    z-index: 100;
    pointer-events: auto;
}

.item-slot {
    width: 55px;
    height: 65px;
    background: linear-gradient(135deg, rgba(30, 30, 50, 0.9), rgba(10, 10, 20, 0.95));
    border: 2px solid #4a4a6a;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s ease;
    position: relative;
}

.item-slot:hover {
    border-color: #f1c40f;
    transform: translateY(-3px);
    box-shadow: 0 5px 15px rgba(241, 196, 15, 0.2);
}

.item-slot:active {
    transform: scale(0.95);
}

.item-slot.has-item {
    border-color: #8e44ad;
    box-shadow: 0 0 10px rgba(142, 68, 173, 0.3);
}

.slot-content {
    font-size: 28px;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
}

.item-count {
    position: absolute;
    bottom: -8px;
    right: -8px;
    background: #c0392b;
    color: #fff;
    font-size: 11px;
    padding: 2px 5px;
    border-radius: 8px;
    font-weight: bold;
    min-width: 16px;
    text-align: center;
}

.slot-key {
    position: absolute;
    top: 2px;
    left: 4px;
    font-size: 10px;
    color: #888;
    font-family: monospace;
}

/* 移动端道具栏适配 */
@media (max-width: 600px) {
    .item-slots {
        bottom: 15px;
        gap: 6px;
    }
    .item-slot {
        width: 45px;
        height: 55px;
    }
    .slot-content {
        font-size: 24px;
    }
    .slot-key {
        display: none;
    }
}

/* ========== 通用法宝显示样式 ========== */
.artifact-hud {
    position: fixed;
    bottom: 100px;
    right: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 5px;
    z-index: 90;
    pointer-events: none;
}

.artifact-icon {
    width: 60px;
    height: 60px;
    background: linear-gradient(135deg, rgba(139, 69, 19, 0.8), rgba(80, 40, 10, 0.9));
    border: 2px solid #f1c40f;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 32px;
    box-shadow: 
        0 0 15px rgba(241, 196, 15, 0.3),
        inset 0 0 20px rgba(0, 0, 0, 0.5);
    animation: artifactFloat 3s ease-in-out infinite;
    position: relative;
}

.artifact-icon::before {
    content: '';
    position: absolute;
    width: 100%;
    height: 100%;
    border-radius: 50%;
    border: 2px solid rgba(241, 196, 15, 0.5);
    animation: artifactPulse 2s ease-in-out infinite;
}

.artifact-name {
    font-size: 12px;
    color: #f1c40f;
    text-shadow: 0 0 5px rgba(0, 0, 0, 0.8);
    white-space: nowrap;
}

.artifact-cd {
    position: absolute;
    bottom: -5px;
    right: -5px;
    background: rgba(0, 0, 0, 0.8);
    color: #fff;
    font-size: 10px;
    padding: 2px 5px;
    border-radius: 8px;
    border: 1px solid #c0392b;
}

.artifact-cd.ready {
    background: rgba(46, 204, 113, 0.8);
    border-color: #2ecc71;
    animation: cdReady 0.5s ease-in-out infinite;
}

/* 法宝类型颜色 */
.artifact-icon.attack { border-color: #e74c3c; box-shadow: 0 0 15px rgba(231, 76, 60, 0.4); }
.artifact-icon.defense { border-color: #3498db; box-shadow: 0 0 15px rgba(52, 152, 219, 0.4); }
.artifact-icon.speed { border-color: #2ecc71; box-shadow: 0 0 15px rgba(46, 204, 113, 0.4); }
.artifact-icon.utility { border-color: #9b59b6; box-shadow: 0 0 15px rgba(155, 89, 182, 0.4); }
.artifact-icon.special { border-color: #f39c12; box-shadow: 0 0 15px rgba(243, 156, 18, 0.4); }

@keyframes artifactFloat {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-5px); }
}

@keyframes artifactPulse {
    0%, 100% { transform: scale(1); opacity: 0.5; }
    50% { transform: scale(1.1); opacity: 0.2; }
}

@keyframes cdReady {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.1); }
}

/* 移动端法宝适配 */
@media (max-width: 600px) {
    .artifact-hud {
        bottom: 80px;
        right: 10px;
    }
    .artifact-icon {
        width: 50px;
        height: 50px;
        font-size: 26px;
    }
    .artifact-name {
        font-size: 10px;
    }
}