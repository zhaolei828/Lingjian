# Context
Filename: task.md
Created On: 2025-11-20
Created By: AI
Associated Protocol: RIPER-5 + Multidimensional + Agent Protocol

# Task Description
Enhance map visual depth by adding "Near/Mid/Far" scenery concepts.
- **Midground**: The gameplay floor (Already implemented).
- **Foreground (Near)**: Atmospheric effects (Weather) overlaid on top (Leaves, Snow, Embers).
- **Implementation**: A `WeatherSystem` with parallax scrolling to simulate depth.

# Project Overview
Lingjian Game.

---
*The following sections are maintained by the AI during protocol execution*
---

# Analysis (Populated by RESEARCH mode)
- **Goal**: "Rich Scene", "Near/Mid/Far".
- **Approach**:
    - Keep existing tile map as Midground.
    - Add `WeatherSystem` for Foreground (Near).
    - Use parallax scrolling for weather to make it feel "above" the ground.

# Proposed Solution (Populated by INNOVATE mode)
- **Stage 1 (Forest)**: Falling Leaves (Green/Yellow).
- **Stage 2 (Bone)**: Floating Dust/Fog (Grey).
- **Stage 3 (Magma)**: Rising Embers (Orange/Red) + Ash.
- **Stage 4 (Ice)**: Blizzard (White snow, fast diagonal).
- **Stage 5 (Void)**: Floating Space Debris (Purple/Blue rocks).

# Implementation Plan (Generated by PLAN mode)
Implementation Checklist:
1.  [ ] Create `js/weather.js` with `WeatherSystem` class.
2.  [ ] Implement particle logic (Leaf, Snow, Ember, Dust) with parallax support.
3.  [ ] Update `js/engine.js`:
    - Import and init `WeatherSystem`.
    - Update weather in `update()`.
    - Draw weather in `draw()` *after* entities, with parallax transform.
