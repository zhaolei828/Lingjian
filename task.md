# Context
Filename: task.md
Created On: 2025-11-20
Created By: AI
Associated Protocol: RIPER-5 + Multidimensional + Agent Protocol

# Task Description
Expand the skill system to implement the Five Elements (Wu Xing) theory: Metal (Gold), Wood, Water, Fire, Earth.
- **Metal (金)**: Existing Sword skills. High fire rate/crit.
- **Wood (木)**: New "Verdant Thorns" (青木刺). Piercing projectiles.
- **Water (水)**: New "Mystic Ice" (玄冥寒冰). Slows enemies on hit.
- **Fire (火)**: Existing "Red Lotus Fire" (红莲业火). AOE Explosion.
- **Earth (土)**: New "Titan Rock" (厚土泰山). High damage + Strong Knockback.
- (Note: Retain "Thunder" as a special/ultimate variant or merge if needed. Current plan: Keep Thunder as a rare "Heavenly" variant outside standard 5 elements, or treat as variant of Gold/Wood. Let's keep it as a special 6th or just a unique one).

# Project Overview
Lingjian Game (HTML5 Canvas).
Current Skills: Sword (Metal-ish), Fire, Thunder.

---
*The following sections are maintained by the AI during protocol execution*
---

# Analysis (Populated by RESEARCH mode)
- **Assets**: Need SVGs for Ice and Wood (Leaf/Thorn). Rock exists (Enemy), can reuse or refine.
- **Enemy Logic**: Need `slowFactor` or `freezeTimer` to support Water effect.
- **Bullet Logic**:
    - Wood: Needs `penetration` counter (pass through N enemies).
    - Water: Apply slow on hit.
    - Earth: Higher knockback force.
- **Player Logic**:
    - `fire` method needs to instantiate correct bullet types.

# Proposed Solution (Populated by INNOVATE mode)
- **SVGs**: Add `ice`, `leaf` to `SVG_LIB`.
- **Enemy Class**:
    - Add `this.slowTimer = 0`.
    - In `update`: if `slowTimer > 0`, speed is reduced (e.g., 50%).
- **Bullet Class**:
    - Constructor: Accept `stats` which includes `element`.
    - `update`:
        - Wood: Rotation animation.
    - `hit`:
        - Wood: Decrement `penetration`. If > 0, don't die.
        - Water: `e.applySlow(2.0)`.
        - Earth: `e.takeDamage(..., knockback * 2)`.
- **Skills**: Add new entries to `SKILLS`.

# Implementation Plan (Generated by PLAN mode)
Implementation Checklist:
1.  [x] Update `SVG_LIB` with `ice` and `leaf` icons in `game.html`.
2.  [x] Update `Enemy` class: Add `slowTimer`, `applySlow` method, and modify `update` logic.
3.  [x] Update `Bullet` class: Implement `pierce`, `ice` visuals, and element-specific hit logic.
4.  [x] Update `Player.fire` to pass `pierce` stats if element is Wood.
5.  [x] Update `SKILLS` array to include Wood, Water, Earth skills.
6.  [x] Add CSS for `.rare-wood`, `.rare-water`, `.rare-earth`.

# Current Execution Step (Updated by EXECUTE mode when starting a step)
> Currently executing: "Final Review"

# Task Progress (Appended by EXECUTE mode after each step completion)
*   2025-11-20
    *   Step: 1-6
    *   Modifications: Full implementation of Five Elements system.
    *   Change Summary: Added Wood (Pierce), Water (Slow), Earth (Knockback) elements alongside existing Metal/Fire/Thunder.
    *   Reason: Executing plan.
    *   Blockers: None.
    *   User Confirmation Status: Pending Confirmation
