# Context
Filename: task.md
Created On: 2025-11-20
Created By: AI
Associated Protocol: RIPER-5 + Multidimensional + Agent Protocol

# Task Description
Enhance Map visuals with procedural backgrounds.
- **Goal**: Replace solid colors with textured backgrounds corresponding to the stage.
- **Method**: Use HTML5 Canvas to procedurally generate tiling textures (Trees for Forest, Cracks for Magma, etc.).
- **Integration**: Update `GameEngine` to render these patterns.

# Project Overview
Lingjian Game.

---
*The following sections are maintained by the AI during protocol execution*
---

# Analysis (Populated by RESEARCH mode)
- **Current**: Solid color + Grid.
- **Needs**:
    - `MapGenerator` module.
    - Pattern caching in `GameEngine`.
    - Updated `draw` loop.

# Proposed Solution (Populated by INNOVATE mode)
- **Stage 1 (Forest)**: Dark green base + Random lighter green circles (bushes) + Dark triangles (trees).
- **Stage 2 (Bone)**: Grey base + Random white lines (bones) + Dark patches.
- **Stage 3 (Magma)**: Dark red base + Orange jagged lines (cracks/lava).
- **Stage 4 (Ice)**: Dark blue base + Cyan diamonds (ice crystals) + White specks.
- **Stage 5 (Void)**: Black base + Random stars.

# Implementation Plan (Generated by PLAN mode)
Implementation Checklist:
1.  [ ] Create `js/map.js` with `generateStagePattern(stageIdx)`.
2.  [ ] Update `js/engine.js`:
    - Load pattern on start/stage change.
    - Render pattern in `draw()`.
    - Remove old grid drawing (or keep it overlayed with lower opacity).
